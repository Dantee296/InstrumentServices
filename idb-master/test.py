import argparse
from ctypes import cdll, c_int, c_char, POINTER, c_char_p, c_byte, pointer, cast, c_void_p, c_uint, create_string_buffer, Structure, c_uint32, c_int32, c_uint16, c_uint64, c_int64, sizeof, create_string_buffer, string_at
from threading import Thread, Event
import time
import traceback
from service import Service
import socket
import uuid
import threading
from zeroconf import ServiceBrowser, Zeroconf
from utils import aes_256_cbc_decrypt, aes_256_cbc_encrypt
import _thread
from device_service import DeviceService
from libimobiledevice import            \
    instrument_client_start_service,    \
    instrument_client_free,             \
    instrument_receive,                 \
    instrument_receive_with_timeout,    \
    instrument_send_command,            \
    InstrumentError

from dtxlib import DTXMessage, DTXMessageHeader,    \
    auxiliary_to_pyobject, pyobject_to_auxiliary,   \
    pyobject_to_selector, selector_to_pyobject
from bpylist import archiver, bplist
from utils import parse_plist_to_xml
import struct

def load_byte_from_hexdump(hd):
  return bytes(map(lambda a:int(a, 16), filter(None, hd.split())))

reg = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 A4 01 00 00 11 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 E5 00 00 00 94 01 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 D5 00 00 00 00 00 00 00 0A 00 00 00 03 00 00 00 09 00 00 00 0A 00 00 00 02 00 00 00 BD 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 31 63 6F 6D 2E 61 70 70 6C 65 2E 69 6E 73 74 72 75 6D 65 6E 74 73 2E 73 65 72 76 65 72 2E 73 65 72 76 69 63 65 73 2E 6F 62 6A 65 63 74 61 6C 6C 6F 63 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 90 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 23 5F 72 65 71 75 65 73 74 43 68 61 6E 6E 65 6C 57 69 74 68 43 6F 64 65 3A 69 64 65 6E 74 69 66 69 65 72 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 82""")

# 3
# launchSuspendedProcessWithDevicePath:bundleIdentifier:environment:arguments:options:
# /private/var/containers/Bundle/Application/D953DAE2-33CE-45FB-9C33-5379E2633B7A/PrivatePhotoManager.app
# com.jimmy.tes1
# {'OAKeepAllocationStatistics': 'YES', 'DYLD_PRINT_TO_STDERR': '1', 'OAWaitForSetupByPid': '461', 'DYLD_INSERT_LIBRARIES': '/Developer/Library/PrivateFrameworks/DVTInstrumentsFoundation.framework/liboainject.dylib', 'OAAllocationStatisticsOutputMask': '0x4f9d0f00', 'OS_ACTIVITY_DT_MODE': '1', 'HIPreventRefEncoding': '1'}
# []
# {'StartSuspendedKey': True, 'iODestinationKey': 0}
launch = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 E4 07 00 00 15 00 00 00 00 00 00 00 03 00 00 00 01 00 00 00 02 00 00 00 F4 06 00 00 D4 07 00 00 00 00 00 00 F0 07 00 00 00 00 00 00 E4 06 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 F3 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 67 2F 70 72 69 76 61 74 65 2F 76 61 72 2F 63 6F 6E 74 61 69 6E 65 72 73 2F 42 75 6E 64 6C 65 2F 41 70 70 6C 69 63 61 74 69 6F 6E 2F 44 39 35 33 44 41 45 32 2D 33 33 43 45 2D 34 35 46 42 2D 39 43 33 33 2D 35 33 37 39 45 32 36 33 33 42 37 41 2F 50 72 69 76 61 74 65 50 68 6F 74 6F 4D 61 6E 61 67 65 72 2E 61 70 70 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C6 0A 00 00 00 02 00 00 00 98 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5E 63 6F 6D 2E 6A 69 6D 6D 79 2E 74 65 73 31 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 6B 0A 00 00 00 02 00 00 00 D9 02 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 AF 10 10 0B 0C 21 22 23 24 25 26 27 28 29 2A 2B 2F 36 37 55 24 6E 75 6C 6C D3 0D 0E 0F 10 18 20 57 4E 53 2E 6B 65 79 73 5A 4E 53 2E 6F 62 6A 65 63 74 73 56 24 63 6C 61 73 73 A7 11 12 13 14 15 16 17 80 02 80 03 80 04 80 05 80 06 80 07 80 08 A7 19 1A 1B 1C 1D 1A 1A 80 09 80 0A 80 0B 80 0C 80 0E 80 0A 80 0A 80 0F 5F 10 1A 4F 41 4B 65 65 70 41 6C 6C 6F 63 61 74 69 6F 6E 53 74 61 74 69 73 74 69 63 73 5F 10 14 44 59 4C 44 5F 50 52 49 4E 54 5F 54 4F 5F 53 54 44 45 52 52 5F 10 13 4F 41 57 61 69 74 46 6F 72 53 65 74 75 70 42 79 50 69 64 5F 10 15 44 59 4C 44 5F 49 4E 53 45 52 54 5F 4C 49 42 52 41 52 49 45 53 5F 10 20 4F 41 41 6C 6C 6F 63 61 74 69 6F 6E 53 74 61 74 69 73 74 69 63 73 4F 75 74 70 75 74 4D 61 73 6B 5F 10 13 4F 53 5F 41 43 54 49 56 49 54 59 5F 44 54 5F 4D 4F 44 45 5F 10 14 48 49 50 72 65 76 65 6E 74 52 65 66 45 6E 63 6F 64 69 6E 67 53 59 45 53 51 31 53 34 36 31 D2 0F 2C 2D 2E 59 4E 53 2E 73 74 72 69 6E 67 80 0D 5F 10 59 2F 44 65 76 65 6C 6F 70 65 72 2F 4C 69 62 72 61 72 79 2F 50 72 69 76 61 74 65 46 72 61 6D 65 77 6F 72 6B 73 2F 44 56 54 49 6E 73 74 72 75 6D 65 6E 74 73 46 6F 75 6E 64 61 74 69 6F 6E 2E 66 72 61 6D 65 77 6F 72 6B 2F 6C 69 62 6F 61 69 6E 6A 65 63 74 2E 64 79 6C 69 62 D2 30 31 32 33 5A 24 63 6C 61 73 73 6E 61 6D 65 58 24 63 6C 61 73 73 65 73 5F 10 0F 4E 53 4D 75 74 61 62 6C 65 53 74 72 69 6E 67 A3 32 34 35 58 4E 53 53 74 72 69 6E 67 58 4E 53 4F 62 6A 65 63 74 5A 30 78 34 66 39 64 30 66 30 30 D2 30 31 38 39 5C 4E 53 44 69 63 74 69 6F 6E 61 72 79 A2 38 35 00 08 00 11 00 1A 00 24 00 29 00 32 00 37 00 49 00 4C 00 51 00 53 00 66 00 6C 00 73 00 7B 00 86 00 8D 00 95 00 97 00 99 00 9B 00 9D 00 9F 00 A1 00 A3 00 AB 00 AD 00 AF 00 B1 00 B3 00 B5 00 B7 00 B9 00 BB 00 D8 00 EF 01 05 01 1D 01 40 01 56 01 6D 01 71 01 73 01 77 01 7C 01 86 01 88 01 E4 01 E9 01 F4 01 FD 02 0F 02 13 02 1C 02 25 02 30 02 35 02 42 00 00 00 00 00 00 02 01 00 00 00 00 00 00 00 3A 00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 45 0A 00 00 00 02 00 00 00 DB 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A3 0B 0C 11 55 24 6E 75 6C 6C D2 0D 0E 0F 10 5A 4E 53 2E 6F 62 6A 65 63 74 73 56 24 63 6C 61 73 73 A0 80 02 D2 12 13 14 15 5A 24 63 6C 61 73 73 6E 61 6D 65 58 24 63 6C 61 73 73 65 73 57 4E 53 41 72 72 61 79 A2 14 16 58 4E 53 4F 62 6A 65 63 74 08 11 1A 24 29 32 37 49 4C 51 53 57 5D 62 6D 74 75 77 7C 87 90 98 9B 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 17 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 A4 0A 00 00 00 02 00 00 00 69 01 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A7 0B 0C 17 18 19 1A 1B 55 24 6E 75 6C 6C D3 0D 0E 0F 10 13 16 57 4E 53 2E 6B 65 79 73 5A 4E 53 2E 6F 62 6A 65 63 74 73 56 24 63 6C 61 73 73 A2 11 12 80 02 80 03 A2 14 15 80 04 80 05 80 06 5F 10 11 53 74 61 72 74 53 75 73 70 65 6E 64 65 64 4B 65 79 5F 10 10 69 4F 44 65 73 74 69 6E 61 74 69 6F 6E 4B 65 79 09 10 00 D2 1C 1D 1E 1F 5A 24 63 6C 61 73 73 6E 61 6D 65 58 24 63 6C 61 73 73 65 73 5F 10 13 4E 53 4D 75 74 61 62 6C 65 44 69 63 74 69 6F 6E 61 72 79 A3 1E 20 21 5C 4E 53 44 69 63 74 69 6F 6E 61 72 79 58 4E 53 4F 62 6A 65 63 74 00 08 00 11 00 1A 00 24 00 29 00 32 00 37 00 49 00 4C 00 51 00 53 00 5B 00 61 00 68 00 70 00 7B 00 82 00 85 00 87 00 89 00 8C 00 8E 00 90 00 92 00 A6 00 B9 00 BA 00 BC 00 C1 00 CC 00 D5 00 EB 00 EF 00 FC 00 00 00 00 00 00 02 01 00 00 00 00 00 00 00 22 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 05 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 54 6C 61 75 6E 63 68 53 75 73 70 65 6E 64 65 64 50 72 6F 63 65 73 73 57 69 74 68 44 65 76 69 63 65 50 61 74 68 3A 62 75 6E 64 6C 65 49 64 65 6E 74 69 66 69 65 72 3A 65 6E 76 69 72 6F 6E 6D 65 6E 74 3A 61 72 67 75 6D 65 6E 74 73 3A 6F 70 74 69 6F 6E 73 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 B3""")

##
## 486
## resume
ressume = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 4C 01 00 00 20 00 00 00 00 00 00 00 03 00 00 00 01 00 00 00 02 00 00 00 A8 00 00 00 3C 01 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 98 00 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8C 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 11 01 E6 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5A 72 65 73 75 6D 65 50 69 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 67""")

# 9
# preparedEnvironmentForLaunch:eventsMask:
# {}
# 1335693056
prepare = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 7F 02 00 00 12 00 00 00 00 00 00 00 09 00 00 00 01 00 00 00 02 00 00 00 BB 01 00 00 6F 02 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 AB 01 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 05 01 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A3 0B 0C 13 55 24 6E 75 6C 6C D3 0D 0E 0F 10 11 12 57 4E 53 2E 6B 65 79 73 5A 4E 53 2E 6F 62 6A 65 63 74 73 56 24 63 6C 61 73 73 A0 A0 80 02 D2 14 15 16 17 5A 24 63 6C 61 73 73 6E 61 6D 65 58 24 63 6C 61 73 73 65 73 5F 10 13 4E 53 4D 75 74 61 62 6C 65 44 69 63 74 69 6F 6E 61 72 79 A3 16 18 19 5C 4E 53 44 69 63 74 69 6F 6E 61 72 79 58 4E 53 4F 62 6A 65 63 74 08 11 1A 24 29 32 37 49 4C 51 53 57 5D 64 6C 77 7E 7F 80 82 87 92 9B B1 B5 C2 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 1A 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CB 0A 00 00 00 02 00 00 00 8E 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 12 4F 9D 0F 00 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 61 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 28 70 72 65 70 61 72 65 64 45 6E 76 69 72 6F 6E 6D 65 6E 74 46 6F 72 4C 61 75 6E 63 68 3A 65 76 65 6E 74 73 4D 61 73 6B 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 87""")

# 9
# startCollectionWithPid:
# 486
par = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 CF 00 00 00 21 00 00 00 00 00 00 00 09 00 00 00 01 00 00 00 02 00 00 00 1C 00 00 00 BF 00 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 0C 00 00 00 00 00 00 00 0A 00 00 00 03 00 00 00 E6 01 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 17 73 74 61 72 74 43 6F 6C 6C 65 63 74 69 6F 6E 57 69 74 68 50 69 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 76""")
# 3
# startObservingPid:
# 486
par2 = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 56 01 00 00 22 00 00 00 00 00 00 00 03 00 00 00 01 00 00 00 02 00 00 00 A8 00 00 00 46 01 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 98 00 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8C 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 11 01 E6 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 12 73 74 61 72 74 4F 62 73 65 72 76 69 6E 67 50 69 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 71""")


# 1
# symbolicatorSignatureForPid:trackingSelector:
# 486
# dyldNotificationReceived:

sys = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 22 02 00 00 18 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 02 00 00 00 59 01 00 00 12 02 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 49 01 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8C 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 11 01 E6 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 0A 00 00 00 02 00 00 00 A5 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 19 64 79 6C 64 4E 6F 74 69 66 69 63 61 74 69 6F 6E 52 65 63 65 69 76 65 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 2D 73 79 6D 62 6F 6C 69 63 61 74 6F 72 53 69 67 6E 61 74 75 72 65 46 6F 72 50 69 64 3A 74 72 61 63 6B 69 6E 67 53 65 6C 65 63 74 6F 72 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 8C""")


# 4294967291
# applicationStateNotification:
# {'execName': 'PrivatePhotoManager', 'state_description': 'Unknown', 'elevated_state_description': 'Unknown', 'displayID': 'com.jimmy.tes1', 'mach_absolute_time': 173662197667, 'appName': 'PrivatePhotoManager', 'elevated_state': 'Unknown', 'timestamp': 1595322598.3195481, 'state': 0, 'pid': 486}

pem = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 80 03 00 00 DD 01 00 00 00 00 00 00 FB FF FF FF 00 00 00 00 02 00 00 00 C7 02 00 00 70 03 00 00 00 00 00 00 F0 03 00 00 00 00 00 00 B7 02 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 AB 02 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 41 42 58 24 76 65 72 73 69 6F 6E 58 24 6F 62 6A 65 63 74 73 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 12 00 01 86 A0 AF 10 16 07 08 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 36 3C 3D 3E 55 24 6E 75 6C 6C D3 09 0A 0B 0C 17 22 57 4E 53 2E 6B 65 79 73 5A 4E 53 2E 6F 62 6A 65 63 74 73 56 24 63 6C 61 73 73 AA 0D 0E 0F 10 11 12 13 14 15 16 80 02 80 03 80 04 80 05 80 06 80 07 80 08 80 09 80 0A 80 0B AA 18 19 19 1B 1C 1D 19 1F 20 21 80 0C 80 0D 80 0D 80 0E 80 0F 80 10 80 0D 80 11 80 13 80 14 80 15 58 65 78 65 63 4E 61 6D 65 5F 10 11 73 74 61 74 65 5F 64 65 73 63 72 69 70 74 69 6F 6E 5F 10 1A 65 6C 65 76 61 74 65 64 5F 73 74 61 74 65 5F 64 65 73 63 72 69 70 74 69 6F 6E 59 64 69 73 70 6C 61 79 49 44 5F 10 12 6D 61 63 68 5F 61 62 73 6F 6C 75 74 65 5F 74 69 6D 65 57 61 70 70 4E 61 6D 65 5E 65 6C 65 76 61 74 65 64 5F 73 74 61 74 65 59 74 69 6D 65 73 74 61 6D 70 55 73 74 61 74 65 53 70 69 64 5F 10 13 50 72 69 76 61 74 65 50 68 6F 74 6F 4D 61 6E 61 67 65 72 57 55 6E 6B 6E 6F 77 6E 5E 63 6F 6D 2E 6A 69 6D 6D 79 2E 74 65 73 31 13 00 00 00 28 6F 12 D7 A3 5F 10 13 50 72 69 76 61 74 65 50 68 6F 74 6F 4D 61 6E 61 67 65 72 D2 33 0B 34 35 57 4E 53 2E 74 69 6D 65 23 41 C2 63 74 33 28 E6 F3 80 12 D2 37 38 39 3A 5A 24 63 6C 61 73 73 6E 61 6D 65 58 24 63 6C 61 73 73 65 73 56 4E 53 44 61 74 65 A2 39 3B 58 4E 53 4F 62 6A 65 63 74 10 00 11 01 E6 D2 37 38 3F 40 5C 4E 53 44 69 63 74 69 6F 6E 61 72 79 A2 3F 3B 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 43 44 54 72 6F 6F 74 80 01 00 08 00 11 00 1A 00 23 00 2D 00 32 00 37 00 50 00 56 00 5D 00 65 00 70 00 77 00 82 00 84 00 86 00 88 00 8A 00 8C 00 8E 00 90 00 92 00 94 00 96 00 A1 00 A3 00 A5 00 A7 00 A9 00 AB 00 AD 00 AF 00 B1 00 B3 00 B5 00 B7 00 C0 00 D4 00 F1 00 FB 01 10 01 18 01 27 01 31 01 37 01 3B 01 51 01 59 01 68 01 71 01 87 01 8C 01 94 01 9D 01 9F 01 A4 01 AF 01 B8 01 BF 01 C2 01 CB 01 CD 01 D0 01 D5 01 E2 01 E5 01 F7 01 FA 01 FF 00 00 00 00 00 00 02 01 00 00 00 00 00 00 00 45 00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 01 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 09 0A 58 24 76 65 72 73 69 6F 6E 58 24 6F 62 6A 65 63 74 73 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 12 00 01 86 A0 A2 07 08 55 24 6E 75 6C 6C 5F 10 1D 61 70 70 6C 69 63 61 74 69 6F 6E 53 74 61 74 65 4E 6F 74 69 66 69 63 61 74 69 6F 6E 3A 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 0B 0C 54 72 6F 6F 74 80 01 08 11 1A 23 2D 32 37 3A 40 60 72 75 7A 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 7C""")



# 1
# symbolicatorSignatureForPid:trackingSelector:
# 486
# dyldNotificationReceived:

coreprofile_cfg2 = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 22 02 00 00 18 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 02 00 00 00 59 01 00 00 12 02 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 49 01 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8C 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 11 01 E6 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 0A 00 00 00 02 00 00 00 A5 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 19 64 79 6C 64 4E 6F 74 69 66 69 63 61 74 69 6F 6E 52 65 63 65 69 76 65 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 2D 73 79 6D 62 6F 6C 69 63 61 74 6F 72 53 69 67 6E 61 74 75 72 65 46 6F 72 50 69 64 3A 74 72 61 63 6B 69 6E 67 53 65 6C 65 63 74 6F 72 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 8C""")
# 1
# symbolicatorSignatureForPid:trackingSelector:
# 0
# dyldNotificationReceived:
sig = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 21 02 00 00 1B 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 02 00 00 00 58 01 00 00 11 02 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 48 01 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8B 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 10 00 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5E 0A 00 00 00 02 00 00 00 A5 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 19 64 79 6C 64 4E 6F 74 69 66 69 63 61 74 69 6F 6E 52 65 63 65 69 76 65 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 2D 73 79 6D 62 6F 6C 69 63 61 74 6F 72 53 69 67 6E 61 74 75 72 65 46 6F 72 50 69 64 3A 74 72 61 63 6B 69 6E 67 53 65 6C 65 63 74 6F 72 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 8C""")

stop = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 A8 00 00 00 23 00 00 00 00 00 00 00 09 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 98 00 00 00 00 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5E 73 74 6F 70 43 6F 6C 6C 65 63 74 69 6F 6E 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 6B""")

reg2 = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 6A 01 00 00 09 00 00 00 00 00 00 00 05 00 00 00 00 00 00 00 02 00 00 00 A6 00 00 00 5A 01 00 00 00 00 00 00 F0 01 00 00 00 00 00 00 96 00 00 00 00 00 00 00 0A 00 00 00 02 00 00 00 8A 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 09 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 5D 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 07 0A 58 24 76 65 72 73 69 6F 6E 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 58 24 6F 62 6A 65 63 74 73 12 00 01 86 A0 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 08 09 54 72 6F 6F 74 80 01 A2 0B 0C 55 24 6E 75 6C 6C 5F 10 28 73 65 74 41 70 70 6C 69 63 61 74 69 6F 6E 53 74 61 74 65 4E 6F 74 69 66 69 63 61 74 69 6F 6E 73 45 6E 61 62 6C 65 64 3A 08 11 1A 24 29 32 37 49 4C 51 53 56 5C 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 87""")

startServ = load_byte_from_hexdump("""79 5B 3D 1F 20 00 00 00 00 00 01 00 A5 00 00 00 46 01 00 00 01 00 00 00 01 00 00 00 00 00 00 00 03 00 00 00 00 00 00 00 95 00 00 00 00 00 00 00 62 70 6C 69 73 74 30 30 D4 01 02 03 04 05 06 09 0A 58 24 76 65 72 73 69 6F 6E 58 24 6F 62 6A 65 63 74 73 59 24 61 72 63 68 69 76 65 72 54 24 74 6F 70 12 00 01 86 A0 A2 07 08 55 24 6E 75 6C 6C 5B 6D 61 63 68 5F 6B 65 72 6E 65 6C 5F 10 0F 4E 53 4B 65 79 65 64 41 72 63 68 69 76 65 72 D1 0B 0C 54 72 6F 6F 74 80 01 08 11 1A 23 2D 32 37 3A 40 4C 5E 61 66 00 00 00 00 00 00 01 01 00 00 00 00 00 00 00 0D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 68 """)

dt = DTXMessage().from_bytes(startServ)
print(dt.channel_code)
print(archiver.unarchive(dt.get_selector()))
#print(dt.parse_plist_to_xml())
for i in dt._auxiliaries:
	print(auxiliary_to_pyobject(i))